# BNI Slide System - 機能追加実装計画

**作成日**: 2025年12月5日
**ステータス**: 実装準備中
**優先度**: 既存システムの安定性を最優先、段階的な機能追加

---

## 実装方針

### 基本原則
1. **既存システムを壊さない** - 現在動作している機能に影響を与えない
2. **データの保全** - 既存のCSVデータやユーザー情報は一切変更しない
3. **段階的な実装** - 小さく確実に機能を追加していく
4. **追加費用ゼロ** - Xserverの既存機能のみで実装
5. **後方互換性** - 新機能追加後も古い機能は継続動作

### リスク管理
- 各機能実装前にブランチを作成
- 実装後は必ずテスト環境で動作確認
- クライアント提出済みのリンクは変更しない
- 問題発生時は即座にロールバック可能にする

---

## 実装タスク一覧

### フェーズ1: 安全性最優先（データ変更なし）
実装時期: 即時開始可能

#### 1. 自動保存機能 ✅ 優先度：最高
- **概要**: アンケート入力中に自動的に下書き保存
- **技術**: JavaScript LocalStorage（ブラウザ内保存、サーバー変更なし）
- **影響範囲**: index.php のJavaScriptのみ
- **実装時間**: 30分〜1時間
- **リスク**: ほぼゼロ（既存機能に影響なし）
- **メリット**: ブラウザクラッシュ時でもデータが残る

**実装内容**:
- フォーム入力時に3秒ごとにLocalStorageに保存
- ページ読み込み時に下書きデータがあれば復元確認
- 送信完了後は下書きデータを削除

---

#### 2. 簡易ダッシュボード ✅ 優先度：高
- **概要**: ログイン後のトップページに週次サマリーを表示
- **技術**: 既存のCSVデータを読み取って統計を表示
- **影響範囲**: index.php の表示部分のみ（読み取り専用）
- **実装時間**: 2〜3時間
- **リスク**: 低（読み取りのみ、データ変更なし）
- **メリット**: ユーザーが自分の貢献度を一目で確認できる

**表示内容**:
- 今週の自分の提出状況
- 今週のチーム全体の統計（総ビジター数、総リファーラル金額）
- 自分の月間統計（ビジター数、リファーラル金額、サンクスリップ数）
- 先週との比較グラフ

---

### フェーズ2: 新機能追加（安全性高）
実装時期: フェーズ1完了後

#### 3. Excelエクスポート機能 ✅ 優先度：高
- **概要**: 管理者がデータをExcel形式でダウンロード
- **技術**: PhpSpreadsheet（無料ライブラリ）
- **影響範囲**: 新しいAPIファイル追加のみ
- **実装時間**: 2時間
- **リスク**: 低（既存機能に影響なし、新機能追加のみ）
- **メリット**: 管理者がデータを分析しやすくなる

**実装内容**:
- admin/edit.php に「Excelダウンロード」ボタンを追加
- api_export_excel.php を新規作成
- フォーマット整形、セル色分け、グラフ自動生成

---

#### 4. パスワードリセット機能 ✅ 優先度：高
- **概要**: パスワードを忘れた際のリセット機能
- **技術**: PHP mail() + トークン生成
- **影響範囲**: 新しいページとAPIの追加、login.phpに「パスワードを忘れた」リンク追加
- **実装時間**: 3時間
- **リスク**: 中（メール送信機能の動作確認が必要）
- **メリット**: ユーザーサポートの手間が減る

**実装内容**:
- forgot-password.php（メールアドレス入力ページ）
- reset-password.php（新しいパスワード設定ページ）
- api_send_reset_email.php（リセットメール送信）
- api_reset_password.php（パスワード更新）
- トークンの有効期限: 24時間

---

### フェーズ3: 高度な機能（慎重に実装）
実装時期: フェーズ2完了後、クライアントの要望に応じて

#### 5. 監査ログ機能 ✅ 優先度：中
- **概要**: 誰がいつ何を編集したかの履歴を記録
- **技術**: JSON形式でログファイルに記録
- **影響範囲**: api_save.php, api_update_my_data.php にログ記録処理を追加
- **実装時間**: 4時間
- **リスク**: 中（既存APIの修正が必要）
- **メリット**: セキュリティと透明性の向上、トラブル時の追跡が可能

**実装内容**:
- logs/audit_log.json に記録
- 記録内容: タイムスタンプ、ユーザー名、操作内容、変更前後のデータ
- admin/audit-log.php で閲覧可能
- フィルタリング機能（日付、ユーザー、操作種別）

---

#### 6. 週次リマインダーメール ✅ 優先度：中
- **概要**: 毎週木曜日の夜に未提出者にメール送信
- **技術**: PHP + Xserver cron
- **影響範囲**: 新しいスクリプト追加、cron設定が必要
- **実装時間**: 3時間
- **リスク**: 中（メール大量送信の動作確認、cron設定）
- **メリット**: アンケート提出率の向上

**実装内容**:
- cron/send_weekly_reminder.php（週次実行スクリプト）
- 毎週木曜日21:00に自動実行
- まだアンケートを提出していないメンバーのみに送信
- メール内容: 提出期限、ログインリンク、簡単な統計

---

#### 7. 2段階認証 ✅ 優先度：低
- **概要**: ログイン時に6桁の認証コードを要求
- **技術**: Google Authenticator（TOTP方式）
- **影響範囲**: ログインフローの変更、profile.phpに設定追加
- **実装時間**: 5時間
- **リスク**: 高（ログイン処理の大幅変更）
- **メリット**: セキュリティの大幅向上

**実装内容**:
- 2段階認証は任意設定（強制しない）
- profile.php に「2段階認証を有効化」ボタン
- QRコード表示、バックアップコード生成
- ログイン時に認証コード入力画面を追加

---

### フェーズ4: 大規模変更（最後に実装）
実装時期: 全ての機能が安定してから

#### 8. SQLite移行 ✅ 優先度：低（将来的な改善）
- **概要**: CSVからSQLiteデータベースへの移行
- **技術**: SQLite3（PHP標準搭載）
- **影響範囲**: ほぼ全てのファイル
- **実装時間**: 8〜10時間
- **リスク**: 非常に高（システム全体の変更）
- **メリット**: 高速化、データ整合性向上、複雑なクエリが可能

**実装内容**:
- データベーススキーマ設計
- CSVからSQLiteへの移行スクリプト
- 全APIの書き換え
- 十分なテスト期間（2週間以上）
- ロールバック手順の確立

---

## 価格モデル提案

### 現状の課題
- **一人2,000円/月** は高額に感じられる可能性が高い
- 30人チャプター = 60,000円/月 = 720,000円/年
- 個人向けSaaSツールと比較して高すぎる

---

### 【提案1】チャプター単位の月額課金（おすすめ）⭐

```
初期費用:
├─ 基本開発費: 80,000円（買い切り）
│  └─ 現在の機能 + フェーズ1〜2の機能を含む
│
└─ オプション追加機能パック: 各20,000円
   ├─ 監査ログ機能
   ├─ 週次リマインダーメール
   ├─ 2段階認証
   └─ SQLite移行

月額費用（保守・運用）:
├─ ベーシックプラン: 5,000円/月
│  ├─ サーバー維持費
│  ├─ セキュリティアップデート
│  ├─ バグ対応
│  └─ メールサポート（3営業日以内返信）
│
├─ スタンダードプラン: 8,000円/月
│  ├─ ベーシックの全て
│  ├─ 月次レポート自動生成
│  ├─ 優先サポート（1営業日以内返信）
│  └─ 軽微な機能追加対応（月1回まで）
│
└─ プレミアムプラン: 12,000円/月
   ├─ スタンダードの全て
   ├─ チャットサポート（営業時間内即時対応）
   ├─ カスタマイズ対応（月2回まで）
   └─ データバックアップサービス（週次）
```

**メリット**:
- 一人あたり負担: 30人チャプターで166円〜400円/月
- 説明しやすい、導入ハードルが低い
- チャプター全体での意思決定なので契約が安定
- 保守費用で継続収入を確保

**デメリット**:
- 個人課金より総額は減る
- ただし、複数チャプターへの横展開で収益増加可能

---

### 【提案2】フリーミアム + 横展開モデル

```
初回チャプター（実績作り）:
├─ 開発費: 50,000円
├─ 月額保守: 3,000円/月（特別価格）
└─ 条件: 導入実績として他チャプターへの紹介を許可

2チャプター目以降:
├─ 導入費: 100,000円/チャプター
├─ 月額保守: 8,000円/月
└─ 紹介割引: 既存チャプターからの紹介で20% OFF
```

**メリット**:
- 初期チャプターで実績作り
- 他チャプターへの販売で収益拡大
- 紹介インセンティブで営業不要
- BNI全国展開の可能性

**収益シミュレーション**:
- 1年目: 3チャプター契約 = 250,000円（初期）+ 228,000円（月額×12ヶ月）= 478,000円
- 2年目: 10チャプター契約 = 1,000,000円（初期）+ 960,000円（月額×12ヶ月）= 1,960,000円

---

### 【提案3】機能別の段階的課金

```
ステージ1（基本システム）: 50,000円
├─ 現在の機能全て
└─ 月額保守: 3,000円/月

ステージ2（利便性向上パック）: +30,000円
├─ 自動保存機能
├─ ダッシュボード
├─ Excelエクスポート
└─ パスワードリセット
└─ 月額保守: 5,000円/月

ステージ3（セキュリティ強化パック）: +40,000円
├─ 監査ログ
├─ 2段階認証
└─ 週次リマインダー
└─ 月額保守: 8,000円/月

ステージ4（エンタープライズ）: +50,000円
├─ SQLite移行
├─ 高速化
└─ カスタムレポート
└─ 月額保守: 12,000円/月
```

**メリット**:
- 必要な機能だけ購入できる
- アップセルしやすい
- 段階的な収益増加

---

### 【提案4】個人課金を維持する場合（非推奨だが可能）

もし個人課金を継続するなら、**一人500円/月**が現実的なラインです。

```
初期費用: 80,000円（チャプター全体）
月額費用: 一人500円/月
├─ 30人チャプター = 15,000円/月
└─ 50人チャプター = 25,000円/月

個人課金を正当化する付加価値:
├─ 個人用月次レポート（PDF自動生成）
├─ 個人ダッシュボード（詳細統計）
├─ モバイルアプリ（PWA）
└─ データエクスポート（個人用）
```

---

## 推奨する価格戦略

### 最もおすすめ: 提案1 + 提案2のハイブリッド

```
【初回チャプター（御社）】
開発費: 50,000円（特別価格）
月額保守: 5,000円/月（スタンダードプラン）
条件: 実績として使用OK、他チャプター紹介協力

【2チャプター目以降】
導入費: 120,000円
月額保守: 8,000円/月
紹介割引: 初回チャプターからの紹介で100,000円

【長期的な収益モデル】
1年目（3チャプター）:
├─ 初期: 50,000 + 120,000×2 = 290,000円
└─ 月額: (5,000 + 8,000×2) × 12 = 252,000円
└─ 年間合計: 542,000円

3年目（15チャプター）:
└─ 月額のみ: (5,000 + 8,000×14) × 12 = 1,404,000円/年
```

**この戦略のメリット**:
1. 初期チャプターの負担を抑える（一人166円/月）
2. 実績作りに集中できる
3. 横展開で大きく収益拡大
4. 継続的な保守費用で安定収入
5. BNIのネットワークを活用した営業展開

---

## 保守内容の明確化

### 月額保守費に含まれるサービス

**ベーシックプラン（5,000円/月）**:
- サーバー監視・維持
- セキュリティアップデート対応
- バグ修正（緊急対応）
- メールサポート（3営業日以内）
- データバックアップ（月1回）

**スタンダードプラン（8,000円/月）**:
- ベーシックの全て
- 月次レポート自動生成（PDF）
- 優先サポート（1営業日以内）
- 軽微な機能追加・修正（月1回まで）
- データバックアップ（週1回）

**プレミアムプラン（12,000円/月）**:
- スタンダードの全て
- チャットサポート（営業時間内）
- カスタマイズ対応（月2回まで）
- データバックアップ（日次）
- システム改善提案（四半期ごと）

---

## 次のステップ

### 即時実行可能なアクション

1. **フェーズ1の実装開始**
   - まず「自動保存機能」から実装
   - 動作確認後、「簡易ダッシュボード」を追加

2. **価格提案書の作成**
   - 上記の価格モデルをクライアント向けに整形
   - 他チャプターへの展開可能性を説明

3. **契約書のドラフト作成**
   - 開発費と保守費を明記
   - サービス内容を具体的に記載
   - 解約条件、SLA（サービスレベル合意）

---

## 実装スケジュール（推奨）

### 第1週（12月5日〜12月11日）
- ✅ 自動保存機能の実装
- ✅ 簡易ダッシュボードの実装
- ✅ Excelエクスポート機能の実装
- ✅ クライアントへのデモ

### 第2週（12月12日〜12月18日）
- パスワードリセット機能の実装
- メール送信テスト
- クライアントフィードバック対応

### 第3週（12月19日〜12月25日）
- 監査ログ機能の実装
- 管理画面の追加
- 総合テスト

### 第4週以降（要相談）
- 週次リマインダーメールの実装
- 2段階認証の実装
- SQLite移行の検討

---

## リスク管理

### バックアップ戦略
- 実装前に必ず現在のシステム全体をバックアップ
- Git管理で各機能実装ごとにコミット
- 問題発生時は即座にロールバック可能

### テスト環境
- 本番環境に影響を与えないテスト環境を用意
- クライアントへの公開前に必ず動作確認

### ロールバック手順
1. Gitで前のコミットに戻る
2. バックアップからファイルを復元
3. クライアントへの状況報告

---

## まとめ

### 実装の優先順位
1. **最優先**: 自動保存機能（今すぐ開始）
2. **高優先**: ダッシュボード、Excelエクスポート
3. **中優先**: パスワードリセット、監査ログ
4. **低優先**: 週次リマインダー、2段階認証、SQLite移行

### 価格モデルの推奨
- **初回チャプター**: 開発費50,000円 + 月額5,000円
- **他チャプター展開**: 導入費120,000円 + 月額8,000円
- **長期的な安定収入**: 複数チャプター契約で月10万円以上を目指す

### 次のアクション
1. 自動保存機能の実装を開始
2. 価格提案をクライアントに提示
3. 他チャプターへの展開可能性を探る

---

**このドキュメントは実装の進捗に合わせて随時更新します。**
