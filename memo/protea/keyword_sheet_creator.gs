/**
 * キーワード一覧シート作成ツール
 * TSVファイルのデータをスプレッドシートに再現
 */

function createKeywordSheet() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();

  // 既存シートを削除して新規作成
  let sheet = ss.getSheetByName('依頼キーワード一覧');
  if (sheet) {
    ss.deleteSheet(sheet);
  }
  sheet = ss.insertSheet('依頼キーワード一覧');

  // ヘッダー行を作成
  const headers = [
    '',
    'キーワード',
    'ステータス',
    '納品URL(AI記事生成用のシートのURLを記載)',
    '備考',
    '対象月',
    '森確認',
    '',
    '',
    '',
    ''
  ];

  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);

  // ヘッダー行のスタイル
  sheet.getRange(1, 1, 1, headers.length)
    .setFontWeight('bold')
    .setBackground('#4A90E2')
    .setFontColor('#FFFFFF')
    .setHorizontalAlignment('center');

  // データ行を挿入
  const data = getKeywordData();
  sheet.getRange(2, 1, data.length, headers.length).setValues(data);

  // 集計表を作成
  createSummaryTable(sheet);

  // 列幅を調整
  sheet.setColumnWidth(1, 50);   // 番号
  sheet.setColumnWidth(2, 250);  // キーワード
  sheet.setColumnWidth(3, 100);  // ステータス
  sheet.setColumnWidth(4, 400);  // 納品URL
  sheet.setColumnWidth(5, 150);  // 備考
  sheet.setColumnWidth(6, 100);  // 対象月
  sheet.setColumnWidth(7, 80);   // 森確認
  sheet.setColumnWidth(8, 80);   // 空白
  sheet.setColumnWidth(9, 100);  // 集計ラベル
  sheet.setColumnWidth(10, 80);  // 本数/単価
  sheet.setColumnWidth(11, 100); // 計

  // 行の高さを調整
  sheet.setRowHeight(1, 30);

  // 枠線を追加
  const dataRange = sheet.getRange(1, 1, 100, headers.length);
  dataRange.setBorder(true, true, true, true, true, true, '#CCCCCC', SpreadsheetApp.BorderStyle.SOLID);

  SpreadsheetApp.getUi().alert('✅ キーワード一覧シートを作成しました！');
}

/**
 * キーワードデータを取得
 */
function getKeywordData() {
  const keywords = [
    [1, 'バナー制作 依頼方法', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/11', '', '', '11月作成', '本数', '単価', '計'],
    [2, 'バナーデザイン 相場', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/11', '', '', '合計', 5, 500, '¥2,500'],
    [3, 'web 広告 効果測定', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/11', '', '', '', '', '', ''],
    [4, 'web 広告 選び方', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/11', '', '', '12月作成', '本数', '単価', '計'],
    [5, 'web サイト の 分析', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/11', '', '', '合計', 33, 600, '¥19,800'],
    [6, '二日酔い 回復 サウナ', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [7, '富裕層 健康投資', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [8, '筋トレ モテる', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [9, '綺麗な体 筋トレ 女性', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [10, '箔押し名刺 メリット', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [11, 'PP 加工 名刺 とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [12, '名刺 用紙 選び方', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [13, '離脱率 とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [14, 'btob サイト改善', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [15, 'web広告 種類 一覧', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [16, 'ホームページ デザイン コツ', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [17, 'ホームページ リニューアル 費用', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [18, '遺品整理 一軒家 費用', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [19, '遺品整理 見積もり 注意点', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [20, '遺品整理業者 選び方', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [21, '遺品整理 供養', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [22, '遺品整理 どこまで', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [23, '遺品整理 誰がする', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [24, '特殊清掃 害虫駆除とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [25, '特殊清掃 臭い 消えない', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [26, '空き家 遺品整理', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [27, 'リスティング広告 とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [28, 'リードナーチャリング とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [29, '営業 ターゲティング とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [30, 'アポイント とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [31, 'ソリューション営業 とは', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [32, '営業 種類', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [33, '医師 開業 何年目', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [34, 'クリニック 開業 準備期間', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [35, '開業医 やめとけ', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [36, 'クリニック 開業 必要な手続き', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [37, '医者 開業 医療機器 選定', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', ''],
    [38, '開業医 患者 来ない', '作成済', 'リライト機能付き_営業用・出力テスト_作業シート_20250418', '', '2025/12', '', '', '', '', '', '']
  ];

  // 39-99行目は空行
  for (let i = 39; i <= 99; i++) {
    keywords.push([i, '', '', '', '', '', '', '', '', '', '', '']);
  }

  return keywords;
}

/**
 * 集計表のスタイルを適用
 */
function createSummaryTable(sheet) {
  // 11月集計のスタイル
  sheet.getRange(2, 9).setFontWeight('bold').setBackground('#E8F4F8');
  sheet.getRange(2, 10, 1, 3).setFontWeight('bold').setBackground('#F8F9FA');
  sheet.getRange(3, 9).setFontWeight('bold').setBackground('#4A90E2').setFontColor('#FFFFFF');
  sheet.getRange(3, 10, 1, 3).setBackground('#E8F4F8').setFontWeight('bold');

  // 12月集計のスタイル
  sheet.getRange(5, 9).setFontWeight('bold').setBackground('#E8F4F8');
  sheet.getRange(5, 10, 1, 3).setFontWeight('bold').setBackground('#F8F9FA');
  sheet.getRange(6, 9).setFontWeight('bold').setBackground('#4A90E2').setFontColor('#FFFFFF');
  sheet.getRange(6, 10, 1, 3).setBackground('#E8F4F8').setFontWeight('bold');

  // ステータス列の条件付き書式（「作成済」は緑背景）
  const statusRange = sheet.getRange(2, 3, 99, 1);
  const rule = SpreadsheetApp.newConditionalFormatRule()
    .whenTextEqualTo('作成済')
    .setBackground('#D4EDDA')
    .setFontColor('#155724')
    .setRanges([statusRange])
    .build();

  const rules = sheet.getConditionalFormatRules();
  rules.push(rule);
  sheet.setConditionalFormatRules(rules);
}

/**
 * メニューを追加
 */
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('🔧 ツール')
    .addItem('📋 キーワード一覧シートを作成', 'createKeywordSheet')
    .addToUi();
}
