# BNI Payment System - 利用ガイド

## 目次
1. [概要](#概要)
2. [メンバー向け: 会費支払い方法](#メンバー向け-会費支払い方法)
3. [管理者向け: ダッシュボード操作](#管理者向け-ダッシュボード操作)
4. [管理者向け: メンバー管理](#管理者向け-メンバー管理)
5. [よくある質問](#よくある質問)
6. [トラブルシューティング](#トラブルシューティング)

---

## 概要

**BNI Payment System** は、毎週火曜日のBNI定例会費（1,000円）をオンライン決済で簡単に集金できるシステムです。

### 主な機能

- **メンバー支払いページ**: メンバーがクレジットカードで会費を支払える
- **管理者ダッシュボード**: 支払い状況をリアルタイムで確認できる
- **メンバー管理**: メンバーの追加・編集・削除が可能
- **CSVエクスポート**: 支払いデータをExcelで管理できる
- **自動記録**: 決済完了後、自動的にデータベースに記録される

### アクセスURL

- **メンバー支払いページ**: https://yojitu.com/bni-payment-system/public/
- **管理者ダッシュボード**: https://yojitu.com/bni-payment-system/public/admin/

---

## メンバー向け: 会費支払い方法

### ステップ1: 支払いページにアクセス

https://yojitu.com/bni-payment-system/public/ を開きます。

### ステップ2: 名前を選択

ドロップダウンメニューから自分の名前を選びます。

![メンバー選択画面](例: 佐藤美咲を選択)

### ステップ3: お支払いボタンをクリック

「お支払いページへ」ボタンをクリックすると、Square決済ページに移動します。

### ステップ4: カード情報入力

Square決済ページで以下を入力:

- **カード番号**: 16桁のクレジットカード番号
- **有効期限**: MM/YY形式
- **CVV**: カード裏面の3桁番号
- **郵便番号**: お住まいの郵便番号

### ステップ5: 決済完了

「Pay ¥1,000」ボタンをクリックすると、決済が完了します。

### ステップ6: 確認画面

決済完了後、「お支払いありがとうございました」画面が表示されます。

- **メンバー名**: 確認のため表示されます
- **支払い金額**: ¥1,000
- **対象週**: 今週分（例: 2025年12月15日の週）
- **支払い日時**: 決済完了日時

**重要**: この画面はスクリーンショットで保存しておくことをおすすめします。

---

## 管理者向け: ダッシュボード操作

### アクセス方法

1. https://yojitu.com/bni-payment-system/public/admin/ にアクセス
2. Basic認証ダイアログが表示されます
3. ユーザー名・パスワードを入力してログイン

### ダッシュボード画面の見方

#### 1. 統計カード（上部）

- **総メンバー数**: 登録されているメンバーの総数
- **支払い済み**: 今週の会費を支払ったメンバー数
- **未払い**: まだ支払っていないメンバー数
- **合計金額**: 今週の総入金額

#### 2. 支払い済みメンバー一覧

緑のチェックマーク ✓ がついたメンバーは支払い済みです。

各行に表示される情報:
- **メンバー名**
- **支払い日時**: 決済が完了した日時

#### 3. CSVエクスポート

「CSVエクスポート」ボタンをクリックすると、今週の支払いデータをダウンロードできます。

**CSVファイルの内容**:
- メンバー名
- メールアドレス
- 支払い金額
- 対象週
- 支払い日時
- Square決済ID

**用途例**:
- Excelで集計
- 会計ソフトへのインポート
- 領収書発行用データ

---

## 管理者向け: メンバー管理

### アクセス方法

管理者ダッシュボード → 左上「メンバー管理」リンクをクリック

または直接: https://yojitu.com/bni-payment-system/public/admin/members.php

---

### メンバーの追加

#### ステップ1: 追加ボタンをクリック

画面上部の「+ 新規メンバー追加」ボタンをクリック

#### ステップ2: 情報入力

- **名前**: フルネーム（例: 山田太郎）
- **メールアドレス**: 連絡先メールアドレス
- **ステータス**: 「有効」を選択

#### ステップ3: 保存

「保存」ボタンをクリックすると、新しいメンバーが登録されます。

---

### メンバーの編集

#### ステップ1: 編集ボタンをクリック

メンバー一覧の右側にある「編集」ボタンをクリック

#### ステップ2: 情報修正

名前やメールアドレスを修正します。

#### ステップ3: 保存

「保存」ボタンをクリックして変更を確定します。

---

### メンバーの削除

#### ステップ1: 削除ボタンをクリック

メンバー一覧の右側にある「削除」ボタンをクリック

#### ステップ2: 確認ダイアログ

「本当に削除しますか？」と表示されます。

**注意**: 削除すると、過去の支払い記録も全て削除されます（復元不可）

#### ステップ3: 削除実行

「OK」をクリックすると削除されます。

---

### メンバーの無効化

退会したメンバーを削除せずに「無効」にすることもできます。

#### メリット:
- 過去の支払い記録が保持される
- 必要に応じて後で再有効化できる
- 統計データに影響しない

#### 手順:
1. メンバーを編集
2. ステータスを「無効」に変更
3. 保存

**無効化されたメンバー**:
- 支払いページのドロップダウンに表示されなくなります
- 過去の支払い記録は残ります

---

## よくある質問

### Q1. 同じ週に2回支払うことはできますか？

**A**: いいえ、できません。システムは1人1週につき1回までの支払いしか受け付けません。既に支払い済みの場合、エラーメッセージが表示されます。

---

### Q2. 先週分の会費を遡って支払えますか？

**A**: いいえ、システムは「今週分」のみ支払いを受け付けます。過去の週の支払いはできません。

---

### Q3. メンバーが自分の名前を間違えて選んだ場合は？

**A**: 管理者がデータベースから該当の支払い記録を削除し、正しいメンバーで再度支払いを行ってください。削除方法は管理者に問い合わせてください。

---

### Q4. 決済は完了したのに、ダッシュボードに反映されません

**A**: 以下を確認してください:

1. **5分待つ**: Webhook処理に数分かかる場合があります
2. **ページをリロード**: ブラウザを更新してください
3. **Square Dashboardを確認**: https://squareup.com/dashboard で決済が記録されているか確認
4. **管理者に連絡**: それでも反映されない場合は管理者に連絡してください

---

### Q5. 領収書は発行されますか？

**A**: Squareから自動的にメール領収書が送信されます。メールアドレスが正しいか確認してください。

---

### Q6. クレジットカードが使えません

**A**: 以下を確認してください:

- カード番号・有効期限・CVVが正しいか
- カードの利用限度額に達していないか
- 海外決済が有効になっているか（Squareはアメリカの企業です）
- デビットカードは利用できません（クレジットカードのみ）

---

### Q7. 会費の金額を変更できますか？

**A**: できません。システムは1,000円固定です。金額変更が必要な場合は、システム管理者にコードの修正を依頼してください。

---

### Q8. メンバーのメールアドレスを変更したい

**A**: 管理者がメンバー管理画面から編集できます。

---

### Q9. 誤って削除したメンバーを復元できますか？

**A**: できません。削除は永久的です。削除する前に必ず確認してください。バックアップがある場合のみ復元可能です。

---

### Q10. モバイルでも使えますか？

**A**: はい、スマートフォンでも利用できます。レスポンシブデザインに対応しています。

---

## トラブルシューティング

### 問題: ページが表示されない（404エラー）

**原因**: URLが間違っている可能性があります。

**解決策**:
- 正しいURL: `https://yojitu.com/bni-payment-system/public/`
- 末尾の `/public/` を忘れずに入力してください

---

### 問題: デザインが崩れている

**原因**: CSSファイルが読み込まれていない可能性があります。

**解決策**:
1. ブラウザのキャッシュをクリア（Ctrl+F5 または Cmd+Shift+R）
2. それでも直らない場合は管理者に連絡

---

### 問題: Basic認証のパスワードを忘れた

**解決策**:
1. サーバーにSSH接続
2. `.htpasswd` ファイルを再生成

```bash
ssh -i ~/.ssh/xs545151.key -p 10022 xs545151@xs545151.xsrv.jp
cd ~/yojitu.com/public_html/bni-payment-system/public/admin
htpasswd -c .htpasswd admin
# 新しいパスワード入力
```

---

### 問題: 「データベースに接続できません」エラー

**原因**: サーバー側の問題の可能性があります。

**解決策**:
1. Xserverサーバーパネルでデータベースが稼働しているか確認
2. `.env` ファイルの接続情報が正しいか確認
3. Xserverサポートに連絡

---

### 問題: Square決済ページで「Invalid Location」エラー

**原因**: Square APIの設定が間違っている可能性があります。

**解決策**:
1. `.env` ファイルの `SQUARE_LOCATION_ID` を確認
2. Square Developer Dashboardで正しいLocation IDを取得
3. システム管理者に連絡

---

## サポート

### 技術的な問題

システム開発者に連絡してください。

### BNIに関する質問

BNI担当者に連絡してください。

### 決済に関する問題

Square サポート: https://squareup.com/help

---

**最終更新**: 2025年12月15日
**バージョン**: 1.0.0
