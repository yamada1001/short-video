# 実装計画 - 2025年12月13日

## プロジェクト概要

本番用PDFに基づき、BNIスライドシステムのスライドを完全にピクセルパーフェクトで再実装する。
膨大な量のタスクがあり、複数のファイルが複雑に絡み合っているため、慎重な設計と段階的な実装が必要。

---

## 📋 タスク一覧（追加変更.pdfより）

### 1. 出欠確認スライド
- **PDF参照**: p.2
- **実装内容**: ピクセルパーフェクト実装
- **管理画面**: メンバー編集可能にする
- **現在の状況**: 未実装

### 2. 削除するスライド
- 朝礼
- Good & New
- 今週のサマリー
- リファーラル金額内訳

### 3. スライド順序変更
- 「名刺交換時」スライドの後に「本日のビジター紹介」を移動

### 4. 本日のビジター紹介後の追加スライド
- **PDF参照**: p.42-59（18ページ）
- **実装内容**: ピクセルパーフェクト実装
- **画像**: とりあえずDEMO画像を使用

### 5. コアバリュー
- **PDF参照**: p.62
- **実装内容**: ピクセルパーフェクト実装

### 6. BNIの目的
- **PDF参照**: p.65-71（7ページ）
- **実装内容**: ピクセルパーフェクト実装

### 7. シェアストーリー
- **PDF参照**: p.73
- **実装内容**: ピクセルパーフェクト実装

### 8. ネットワーク学習コーナー
- **現在の状況**: 既存実装あり（確認が必要）

### 9. 月間チャンピオン
- ビジターチャンピオン
- 1to1チャンピオン
- CEUチャンピオン

### 10. 更新メンバーの発表
- **PDF参照**: p.111（タイトル）、p.113（メンバーリスト）
- **実装内容**: ピクセルパーフェクト実装
- **管理画面**: 管理者が更新メンバーを選択可能にする

### 11. ウィークリープレゼンテーション
- **管理画面**: 発表者を選択可能にする
- **タイマー**: スライド移動時に2分タイマー自動スタート
- **ファイル添付**: 不要

### 12. 各メンバー33秒間のプレゼン
- **現在の状況**: 作成済み
- **タスク**: 順序移動のみ

### 13. ビジター様による自己紹介
- **PDF参照**: p.182
- **実装内容**: ピクセルパーフェクト実装
- **タイマー**: 23秒カウントダウン
- **データ**: 管理者/ユーザーからのビジター情報を反映

### 14. ビジネスブレイクアウト
- **PDF参照**: p.198-200（3ページ）
- **実装内容**: ピクセルパーフェクト実装
- **タイマー**: 5分

### 15. バイス・プレジデントによる統計情報
- **PDF参照**: p.203-206（4ページ）
- **実装内容**: ピクセルパーフェクト実装
- **管理画面**: 数字の部分を管理者が入力可能にする

### 16. 募集カテゴリアンケート
- **PDF参照**: p.211
- **実装内容**: ピクセルパーフェクト実装

### 17. 一般規定
- **PDF参照**: p.213
- **実装内容**: ピクセルパーフェクト実装

### 18. メインプレゼン
- **現在の状況**: 作成済み
- **タスク**: 場所の移動のみ

### 19. リファーラルと推薦発表
- **PDF参照**: p.228
- **実装内容**: ピクセルパーフェクト実装

### 20. ビジター様による本日の一言感想
- **PDF参照**: p.230
- **実装内容**: ピクセルパーフェクト実装
- **流れ**: ビジター様自己紹介と同じような作り

### 21. リファーラル信頼度の確認
- **PDF参照**: p.246-253（8ページ）
- **実装内容**: ピクセルパーフェクト実装

### 22. 終礼
- **PDF参照**: p.303-328（26ページ）
- **実装内容**: ピクセルパーフェクト実装

---

## 📊 合計ページ数

- **新規作成**: 約76ページ
- **順序変更**: 3-4箇所
- **削除**: 4種類のスライド
- **管理画面追加**: 約5-6画面

---

## 🔧 影響を受けるファイル（予測）

### フロントエンド
1. `assets/js/svg-slide-generator.js` - スライド生成ロジック（最重要）
2. `assets/js/slide.js` - スライド表示制御
3. `assets/css/slide.css` - スライドスタイル

### バックエンド
4. `api_load.php` - データ読み込みAPI
5. `api_save.php` - データ保存API（既存）
6. 新規API（複数）- 各管理画面用

### 管理画面
7. `admin/slide.php` - スライド表示画面（タイマー機能追加）
8. 新規管理画面（複数）- 出欠確認、更新メンバー、ウィークリープレゼン、統計情報など

### データベース
9. `database/schema.sql` - 新テーブル定義
10. 新規マイグレーションファイル（複数）

---

## 🎯 実装の優先順位

### Phase 1: 調査・設計（現在）
- [ ] 現在のスライド生成ロジックの完全理解
- [ ] 既存の管理画面の確認
- [ ] データベーススキーマの確認
- [ ] 削除するスライドの特定
- [ ] スライド順序の現状確認

### Phase 2: 削除と順序変更
- [ ] 不要スライドの削除
- [ ] 既存スライドの順序変更
- [ ] 動作確認

### Phase 3: 静的スライドの実装（管理画面不要）
- [ ] p.42-59（本日のビジター紹介後）
- [ ] p.62（コアバリュー）
- [ ] p.65-71（BNIの目的）
- [ ] p.73（シェアストーリー）
- [ ] p.182（ビジター様自己紹介）
- [ ] p.198-200（ビジネスブレイクアウト）
- [ ] p.211（募集カテゴリアンケート）
- [ ] p.213（一般規定）
- [ ] p.228（リファーラルと推薦発表）
- [ ] p.230（ビジター様本日の一言感想）
- [ ] p.246-253（リファーラル信頼度の確認）
- [ ] p.303-328（終礼）

### Phase 4: 動的スライドの実装（管理画面必要）
- [ ] 出欠確認（p.2） + 管理画面
- [ ] 更新メンバー（p.111, 113） + 管理画面
- [ ] ウィークリープレゼンテーション + 管理画面 + 2分タイマー
- [ ] バイス・プレジデント統計情報（p.203-206） + 管理画面

### Phase 5: タイマー機能の実装
- [ ] 2分タイマー（ウィークリープレゼン）
- [ ] 23秒タイマー（ビジター自己紹介）
- [ ] 5分タイマー（ビジネスブレイクアウト）

### Phase 6: 最終確認
- [ ] 全スライドの表示確認
- [ ] 順序の確認
- [ ] タイマーの動作確認
- [ ] 管理画面の動作確認
- [ ] 本番環境デプロイ

---

## ⚠️ 重要な注意事項

1. **バックアップ必須**
   - 各Phase開始前に必ずgit commitを実行
   - 重要なファイルは`.backup`を作成

2. **MDファイル更新**
   - 5分ごとにこのファイルを更新
   - 作業内容を詳細に記録

3. **ピクセルパーフェクト**
   - 本番用PDFを完全に再現
   - 変な工夫は入れない
   - 実装が難しい場合は画像を使用

4. **慎重な実装**
   - 一度に複数のタスクを実行しない
   - 1つずつ確実に実装
   - 各タスク完了後に動作確認

---

## 📝 現在のスライド構造（svg-slide-generator.js）

### 現在の生成順序
1. Slide 1: Title（タイトル）
2. **Slide 2: Summary（今週のサマリー）** ← **削除対象**
3. Slide 3: Visitor Introductions（ビジター紹介）
4. **Slide 4: Referral Amount Breakdown（リファーラル金額内訳）** ← **削除対象**
5. Slide 5: Member Contributions
6. Slide 5.5: Member 60-Second Pitch Slides
7. Slide 6: Detailed Referral List
8. Slide 6.5: Member Pitch Presentation
9. Slide 7.5: Visitor Feedback Slides
10. Phase 2: Main Presentation
11. Phase 3: Referral Announcements Template
12. Phase 4: New Members
13. Phase 5: Monthly Champions
14. Phase 6: Happy Birthday
15. Phase 7: Weekly NO.1
16. Phase 8: Secretary Message
17. Phase 9: Director Message
18. Phase 10: Visitor Hosts
19. Phase 11: BNI Philosophy & Core Values
20. Phase 12: Networking Education Corner
21. Phase 13: Visitor Self-Introduction Template
22. Phase 14: Speaker Rotation
23. Phase 15: Today's Comment Template
24. Phase 16: Visitor Orientation
25. Phase 17: From Coordinators
26. Phase 18: Closing
27. Slide 8: Thank You

### 削除対象の特定
- **朝礼**: コード内に見当たらず（削除済みの可能性）
- **Good & New**: `generateGoodAndNewSlide()` 関数（行633）← **削除対象**
- **今週のサマリー**: Slide 2: Summary（行81-105）← **削除対象**
- **リファーラル金額内訳**: Slide 4（行113-150）← **削除対象**

### 既存の関数（再利用可能）
- `generateAttendanceCheckSlide()` - 出欠確認（要修正）
- `generateBusinessCardSeatingSlide()` - 名刺交換時
- `generatePresidentMessageSlide()` - プレジデントメッセージ
- `generateBNIPhilosophySlides()` - BNI理念（要確認）
- `generateNewMembersSlides()` - 新入会メンバー（要修正）
- `generateNetworkingEducationSlide()` - ネットワーク学習コーナー
- `generateMonthlyChampionsSlides()` - 月間チャンピオン
- `generateMemberPitchSlides()` - メンバーピッチ（33秒）
- `generateVisitorIntroductionListSlides()` - ビジター紹介リスト
- `generateVisitorSelfIntroductionSlides()` - ビジター自己紹介

---

## 📝 次のステップ

### ✅ 完了
1. 現在のスライド生成ロジックを完全に理解する
2. 削除するスライドを特定する

### 🔄 進行中
3. **既存の管理画面を確認する**（次のタスク）
   - admin/ディレクトリ内のファイルを確認
   - 既存の管理画面構造を把握

### ⏳ 未着手
4. **実装計画の詳細化**
   - 各Phaseの具体的な実装手順
   - 必要なファイルのリスト
   - データベーススキーマの設計

---

**最終更新**: 2025年12月13日 19:50
**ステータス**: Phase 1 - 調査・設計中（スライド構造の把握完了）
**次回更新予定**: 5分後（19:55）

## 📂 既存の管理画面（admin/）

### 現在存在する管理画面
1. `bulk_input.php` - 一括入力
2. `edit.php` - データ編集
3. `monthly_ranking.php` - 月間ランキング
4. `networking_learning.php` - ネットワーク学習コーナー ← **既存**
5. `referrals.php` - リファーラル管理
6. `seating.php` - 座席表編集
7. `slide.php` - スライド表示
8. `users.php` - ユーザー管理
9. `visitor_intro.php` - ビジター紹介管理 ← **既存**

### 新規作成が必要な管理画面
1. **出欠確認管理** - メンバーの出欠を編集
2. **更新メンバー管理** - 更新メンバーを選択
3. **ウィークリープレゼン管理** - 発表者を選択
4. **統計情報管理** - バイスプレジデント用の数字入力

---

## 🎯 実装の優先順位（詳細版）

### Phase 1: 調査・設計 ✅
- [x] 現在のスライド生成ロジックの完全理解
- [x] 既存の管理画面の確認
- [x] データベーススキーマの確認
- [x] 削除するスライドの特定
- [x] スライド順序の現状確認

### Phase 2: 削除と順序変更（最優先）
**推定時間**: 30分 | **リスク**: 低

1. [ ] Good & Newスライド削除
2. [ ] 今週のサマリー削除
3. [ ] リファーラル金額内訳削除
4. [ ] スライド順序変更
5. [ ] 動作確認

---

**実装計画の詳細はこのファイルに今後追記していきます**

**最終更新**: 2025年12月13日 20:05
**ステータス**: Phase 1 完了 - 実装計画作成完了
**次のアクション**: ユーザーに確認を取る

---

## 📅 作業ログ

**2025年12月13日 20:55** - Phase 2実装前の最終チェック開始
- 関係各所のファイルを全て確認中
- svg-slide-generator.js の現在の構造を確認
- slide.js の API連携部分を確認
- api_load.php の現在の実装を確認


**2025年12月13日 21:01** - Phase 2実装前の最終チェック完了

### ✅ 確認結果

#### 1. svg-slide-generator.js
- L78: Good & New呼び出し（削除対象）
- L81-105: 今週のサマリー（削除対象）
- L113-150: リファーラル金額内訳（削除対象）
- L633: generateGoodAndNewSlide()関数（削除対象）

#### 2. slide.js ⚠️ **重要な発見**
- L450-546: 古いスライド生成コード（デッドコード）が残っている
- L186: generateSVGSlides()を呼んでいるため、svg-slide-generator.jsを使用
- **結論**: slide.jsの古いコードも削除する必要あり

#### 3. api_load.php
- stats計算処理は他のスライドでも使用されているため削除不可
- データ取得処理のみで、特定のスライド生成コードはなし
- **結論**: 修正不要

### 📋 Phase 2の修正対象ファイル（確定版）

1. **svg-slide-generator.js**
   - L78削除: `slides += generateGoodAndNewSlide();`
   - L81-105削除: Slide 2: Summary全体
   - L113-150削除: Slide 4: Referral Amount Breakdown全体
   - L633削除: `function generateGoodAndNewSlide() { ... }`

2. **slide.js**（新規追加）
   - L450-546削除: デッドコード全体

3. **api_load.php**
   - 修正不要

### ⚠️ リスク評価

- **リスクレベル**: 低
- **理由**: 削除のみで、他のスライドへの影響なし
- **デッドコード削除**: slide.jsのデッドコード削除により、コードが整理される

---

**2025年12月13日 21:05** - Phase 2コード削除完了

### ✅ 削除実施結果

#### 1. svg-slide-generator.js
- ✅ L78削除完了: Good & New呼び出し
- ✅ L81-105削除完了: 今週のサマリー
- ✅ L113-150削除完了: リファーラル金額内訳
- ✅ L633削除完了: generateGoodAndNewSlide()関数

#### 2. slide.js
- ✅ L431-651削除完了: デッドコード（古いスライド生成コード）
- ✅ バックアップ作成: slide.js.backup

### 📋 次のステップ
- [ ] ローカル環境でのテスト
- [ ] ブラウザコンソールエラー確認
- [ ] git commit + push
- [ ] 本番環境デプロイ確認

