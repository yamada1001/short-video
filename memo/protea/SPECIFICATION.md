# Protea Webアプリ　システム仕様書

**作成日**: 2025-12-30
**バージョン**: 1.0
**対象**: SEO記事作成支援システム

---

## 📋 目次

1. [システム概要](#システム概要)
2. [機能一覧](#機能一覧)
3. [画面設計](#画面設計)
4. [データベース設計](#データベース設計)
5. [ワークフロー](#ワークフロー)
6. [技術スタック](#技術スタック)
7. [制約事項](#制約事項)

---

## 1. システム概要

### 目的

- Googleスプレッドシート管理からの脱却
- スクレイピングデータの一元管理
- GPT APIを活用した記事自動生成
- チームでの進捗管理

### 現状の課題

- Pythonスクレイピング結果（Excel）とスプレッドシートの二重管理
- 記事生成フローが手動で非効率
- 進捗管理が煩雑

### 解決策

Excelインポート → データ管理 → 記事生成 → 公開までをWebアプリで一元化

---

## 2. 機能一覧

### 2.1 Excelインポート機能

| 項目 | 内容 |
|------|------|
| 機能 | Pythonスクレイピング結果（Excelファイル）をアップロード |
| 入力 | .xlsxファイル（1キーワード=1ファイル） |
| 処理 | 5シート（ブログ記事・共起語・サジェスト・URL本文・Yahoo知恵袋）をパースしてDB保存 |
| 出力 | キーワードマスタ登録 + 各種データテーブルに格納 |
| 備考 | PhpSpreadsheetライブラリ使用 |

**Excelファイル構造**:
- **ファイル名**: `20251222_0159_開業医_患者_来ない.xlsx`
- **シート1 - ブログ記事**: `URL`, `タイトル` (10行)
- **シート2 - 共起語**: `共起語` (20行)
- **シート3 - サジェスト**: `クエリ`, `サジェスト` (4行)
- **シート4 - URL本文**: `URL`, `タイトル`, `本文` (5行)
- **シート5 - Yahoo知恵袋**: `URL`, `質問`, `ベストアンサー` (10行)

### 2.2 キーワード管理機能

| 項目 | 内容 |
|------|------|
| 機能 | キーワード一覧表示・検索・フィルタ・ステータス管理 |
| 一覧表示 | ID, キーワード, ステータス, 対象月, アップロード日時 |
| ステータス | 未着手 / スクレイピング完了 / 記事生成中 / 記事完成 / 公開済 |
| フィルタ | ステータス別, 対象月別 |
| 検索 | キーワード名で部分一致検索 |
| アクション | 詳細表示, 記事生成, 削除 |

### 2.3 詳細表示機能

| 項目 | 内容 |
|------|------|
| 機能 | 選択したキーワードのスクレイピングデータを表示 |
| 表示内容 | 競合ブログ10件, 共起語20件, サジェスト4件, 競合本文5件, Yahoo知恵袋10件 |
| UI | タブ切り替え（ブログ / 共起語 / サジェスト / 本文 / 知恵袋） |

### 2.4 記事生成機能（GPT API）

| 項目 | 内容 |
|------|------|
| 機能 | GPT APIで記事を自動生成 |
| 入力 | キーワード, プロンプトテンプレート選択 |
| 処理 | スクレイピングデータ（共起語・競合タイトル・Yahoo知恵袋）をプロンプトに挿入してGPT API呼び出し |
| 出力 | タイトル + 本文（5000文字以上） |
| GPTモデル | gpt-4, gpt-4-turbo, gpt-3.5-turbo（選択可能） |
| プロンプト | テンプレート管理機能あり |

**プロンプト変数**:
- `{{keyword}}`: キーワード
- `{{cooccurrence}}`: 共起語リスト（カンマ区切り）
- `{{competitor_titles}}`: 競合記事タイトルリスト
- `{{yahoo_qa}}`: Yahoo知恵袋Q&A

### 2.5 記事編集・プレビュー機能

| 項目 | 内容 |
|------|------|
| 機能 | 生成された記事の編集・プレビュー |
| エディタ | TinyMCE または Quill（WYSIWYGエディタ） |
| プレビュー | 実際のブログ表示をシミュレート |
| 保存 | 下書き保存, 公開 |

### 2.6 プロンプトテンプレート管理

| 項目 | 内容 |
|------|------|
| 機能 | GPTプロンプトのテンプレート作成・編集・選択 |
| デフォルト | 「SEO記事基本」テンプレート |
| 作成 | 新規テンプレート登録 |
| 編集 | 既存テンプレート修正 |
| 変数 | {{keyword}}, {{cooccurrence}}, {{competitor_titles}}, {{yahoo_qa}} |

### 2.7 ダッシュボード

| 項目 | 内容 |
|------|------|
| 機能 | 全体の進捗状況を可視化 |
| 表示項目 | 総キーワード数, ステータス別件数, 月別集計, 最近の活動 |
| グラフ | ステータス別円グラフ, 月別棒グラフ |

---

## 3. 画面設計

### 3.1 画面一覧

| No | 画面名 | URL | 説明 |
|----|--------|-----|------|
| 1 | ダッシュボード | `/protea/` | 全体進捗表示 |
| 2 | Excelアップロード | `/protea/upload.php` | Excelファイルアップロード |
| 3 | キーワード一覧 | `/protea/keywords.php` | キーワード管理 |
| 4 | キーワード詳細 | `/protea/keyword_detail.php?id=123` | スクレイピングデータ表示 |
| 5 | 記事生成 | `/protea/generate_article.php?keyword_id=123` | GPT記事生成 |
| 6 | 記事編集 | `/protea/edit_article.php?id=456` | 記事編集・プレビュー |
| 7 | プロンプト管理 | `/protea/prompts.php` | テンプレート管理 |

### 3.2 画面レイアウト

#### ダッシュボード

```
┌─────────────────────────────────────┐
│ 🎯 Protea - SEO記事管理システム       │
├─────────────────────────────────────┤
│ ナビゲーション:                      │
│ [ダッシュボード] [アップロード] [キーワード] [プロンプト] │
├─────────────────────────────────────┤
│                                     │
│  📊 全体統計                         │
│  ┌─────┬─────┬─────┬─────┐       │
│  │総数  │完了  │生成中│公開済│       │
│  │ 38  │ 38  │  0  │  0  │       │
│  └─────┴─────┴─────┴─────┘       │
│                                     │
│  📈 ステータス別グラフ                │
│  [円グラフ]                          │
│                                     │
│  📅 月別集計                         │
│  11月: 5件 | 12月: 33件             │
│                                     │
│  🔔 最近の活動                       │
│  ・開業医 患者 来ない - Excel UP     │
│  ・バナー制作 依頼方法 - 記事生成完了 │
│                                     │
└─────────────────────────────────────┘
```

#### Excelアップロード画面

```
┌─────────────────────────────────────┐
│ 📤 Excelファイルアップロード          │
├─────────────────────────────────────┤
│                                     │
│  ファイル選択:                       │
│  [ファイルを選択]  📁               │
│                                     │
│  アップロード済みファイル:            │
│  20251222_0159_開業医_患者_来ない.xlsx│
│                                     │
│  [アップロード] [キャンセル]          │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                     │
│  📋 アップロード済みキーワード        │
│  ┌─────────────────────────────┐  │
│  │ 開業医 患者 来ない (12/22)    │  │
│  │ ステータス: スクレイピング完了  │  │
│  └─────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

#### キーワード一覧画面

```
┌─────────────────────────────────────────────────────┐
│ 📋 キーワード一覧                                     │
├─────────────────────────────────────────────────────┤
│ 検索: [____________]  ステータス: [全て▼]  月: [全て▼] │
├─────────────────────────────────────────────────────┤
│ No │ キーワード          │ ステータス  │ 対象月 │ アクション │
├────┼────────────────────┼────────────┼────────┼───────────┤
│ 1  │ 開業医 患者 来ない  │ 完了        │ 12月   │ [詳細][生成]│
│ 2  │ バナー制作 依頼方法 │ 完了        │ 11月   │ [詳細][生成]│
│ 3  │ web 広告 効果測定   │ 完了        │ 11月   │ [詳細][生成]│
│ ...│                    │             │        │            │
└─────────────────────────────────────────────────────┘
```

#### キーワード詳細画面（タブ切り替え）

```
┌─────────────────────────────────────────┐
│ キーワード: 開業医 患者 来ない          │
├─────────────────────────────────────────┤
│ [ブログ] [共起語] [サジェスト] [本文] [知恵袋] │
├─────────────────────────────────────────┤
│                                         │
│ 【ブログ記事】                          │
│ ┌───────────────────────────────────┐ │
│ │ 1. 開業医になったけど患者さんが来ない？│ │
│ │    https://matsukiyococokara-medi...│ │
│ │                                     │ │
│ │ 2. クリニック開業時の集患対策        │ │
│ │    https://example.com/...          │ │
│ │                                     │ │
│ │ ... (10件表示)                      │ │
│ └───────────────────────────────────┘ │
│                                         │
│ [記事生成する]                          │
│                                         │
└─────────────────────────────────────────┘
```

#### 記事生成画面

```
┌─────────────────────────────────────────┐
│ ✍️ 記事生成: 開業医 患者 来ない          │
├─────────────────────────────────────────┤
│ プロンプトテンプレート:                 │
│ [SEO記事基本 ▼]                         │
│                                         │
│ GPTモデル:                              │
│ ○ gpt-4  ○ gpt-4-turbo  ○ gpt-3.5     │
│                                         │
│ 使用データ:                             │
│ ☑ 共起語 (20件)                        │
│ ☑ 競合タイトル (10件)                  │
│ ☑ Yahoo知恵袋 (10件)                   │
│                                         │
│ [生成開始] [キャンセル]                 │
│                                         │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━          │
│                                         │
│ 生成結果:                               │
│ ┌───────────────────────────────────┐ │
│ │ タイトル: 開業医が患者を集める5つの方法│ │
│ │                                     │ │
│ │ 本文:                               │ │
│ │ クリニックを開業したものの、患者さんが│ │
│ │ 来なくて悩んでいませんか？           │ │
│ │ ...                                 │ │
│ └───────────────────────────────────┘ │
│                                         │
│ [保存] [編集] [再生成]                  │
│                                         │
└─────────────────────────────────────────┘
```

---

## 4. データベース設計

### 4.1 テーブル一覧

| No | テーブル名 | 説明 | 行数目安 |
|----|-----------|------|---------|
| 1 | keywords | キーワードマスタ | 100件 |
| 2 | blog_articles | 競合ブログ記事 | 1,000件 (100キーワード×10件) |
| 3 | cooccurrence_words | 共起語 | 2,000件 (100キーワード×20件) |
| 4 | suggestions | サジェスト | 400件 (100キーワード×4件) |
| 5 | article_contents | 競合記事本文 | 500件 (100キーワード×5件) |
| 6 | yahoo_qa | Yahoo知恵袋 | 1,000件 (100キーワード×10件) |
| 7 | generated_articles | 生成記事 | 100件 |
| 8 | prompt_templates | プロンプトテンプレート | 10件 |

### 4.2 ER図

```
keywords (1) ─┬─ (N) blog_articles
              ├─ (N) cooccurrence_words
              ├─ (N) suggestions
              ├─ (N) article_contents
              ├─ (N) yahoo_qa
              └─ (N) generated_articles

prompt_templates (1) ─ (N) generated_articles
```

### 4.3 主要テーブル詳細

**keywords テーブル**:
- `id`: INT (PK)
- `keyword`: VARCHAR(255) (UNIQUE)
- `status`: ENUM('未着手', 'スクレイピング完了', '記事生成中', '記事完成', '公開済')
- `target_month`: DATE
- `excel_filename`: VARCHAR(255)
- `uploaded_at`: TIMESTAMP
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

**generated_articles テーブル**:
- `id`: INT (PK)
- `keyword_id`: INT (FK)
- `title`: VARCHAR(255)
- `content`: LONGTEXT
- `gpt_model`: VARCHAR(50)
- `prompt_template`: TEXT
- `word_count`: INT
- `status`: ENUM('下書き', 'レビュー中', '公開済')
- `published_at`: TIMESTAMP
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

---

## 5. ワークフロー

### 5.1 全体フロー

```
1. Pythonスクレイピング（ローカル）
   ↓ Excel出力
2. Excelアップロード（Webアプリ）
   ↓ データパース
3. DB保存（5シート → 5テーブル）
   ↓ キーワード登録
4. キーワード一覧表示
   ↓ 詳細表示
5. 記事生成（GPT API）
   ↓ タイトル + 本文生成
6. 記事編集・プレビュー
   ↓ 修正・保存
7. 記事公開
```

### 5.2 詳細フロー（記事生成）

```
1. キーワード選択
   ↓
2. プロンプトテンプレート選択
   ↓
3. スクレイピングデータ取得
   - 共起語 (cooccurrence_words)
   - 競合タイトル (blog_articles)
   - Yahoo知恵袋 (yahoo_qa)
   ↓
4. プロンプト生成
   - テンプレートに変数を埋め込み
   ↓
5. GPT API呼び出し
   - gpt-4 / gpt-4-turbo / gpt-3.5
   ↓
6. レスポンス受信
   - タイトル抽出
   - 本文抽出
   - 文字数カウント
   ↓
7. DB保存 (generated_articles)
   - status: '下書き'
   ↓
8. 記事編集画面へ遷移
```

---

## 6. 技術スタック

### 6.1 バックエンド

| 技術 | バージョン | 用途 |
|------|----------|------|
| PHP | 7.4+ | メインロジック |
| MySQL | 5.7+ | データベース |
| PhpSpreadsheet | 1.x | Excel読み込み |
| Guzzle | 7.x | HTTP Client (GPT API) |

### 6.2 フロントエンド

| 技術 | バージョン | 用途 |
|------|----------|------|
| HTML/CSS | - | UI |
| JavaScript | ES6 | インタラクション |
| Chart.js | 4.x | グラフ表示 |
| TinyMCE | 6.x | WYSIWYGエディタ |

### 6.3 外部API

| API | 用途 | 料金 |
|-----|------|------|
| OpenAI GPT API | 記事生成 | 従量課金 |

### 6.4 サーバー環境

- **ホスティング**: Xserver
- **PHP**: 7.4+
- **MySQL**: 5.7+
- **ストレージ**: 10GB（Excel保存用）

---

## 7. 制約事項

### 7.1 技術的制約

- Xserverではスクレイピング不可 → Pythonローカルで実行
- PHPタイムアウト: 最大300秒（GPT API待機時間）
- ファイルサイズ上限: 10MB/アップロード

### 7.2 運用上の制約

- キーワード数: 最大1,000件
- 同時アップロード: 1ファイルずつ（バッチ処理なし）
- GPT API: 月間トークン数制限あり

### 7.3 セキュリティ

- ログイン機能: 将来実装（現在は実装しない）
- CSRF対策: 必須
- SQLインジェクション対策: プリペアドステートメント使用
- ファイルアップロード: 拡張子・MIMEタイプチェック

---

## 8. 開発スケジュール

| フェーズ | 作業内容 | 期間 |
|---------|---------|------|
| Phase 1 | DB設計・テーブル作成 | 1日 |
| Phase 2 | Excelアップロード機能 | 2日 |
| Phase 3 | キーワード管理画面 | 2日 |
| Phase 4 | 記事生成機能（GPT API） | 3日 |
| Phase 5 | 記事編集・プレビュー | 2日 |
| Phase 6 | ダッシュボード・統計 | 1日 |
| Phase 7 | テスト・デバッグ | 2日 |
| **合計** | | **13日** |

---

## 9. 今後の拡張案

- ログイン・権限管理
- スケジュール自動実行（cron）
- WordPress連携（記事自動投稿）
- 外部スクレイピングサービス連携
- A/Bテスト機能
- SEO分析ダッシュボード

---

**承認欄**

| 役職 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| 依頼者 |  |  |  |
| 開発者 | Claude |  |  |

---

**変更履歴**

| 日付 | バージョン | 変更内容 | 変更者 |
|------|----------|---------|--------|
| 2025-12-30 | 1.0 | 初版作成 | Claude |
